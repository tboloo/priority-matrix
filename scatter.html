<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.9.1.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link rel="stylesheet" href="/css/style.css">
    <meta charset="utf-8">

    <!-- Example based on http://bl.ocks.org/mbostock/3887118 -->
    <!-- Tooltip example from http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html -->

    <style>
        body {
            font: 11px sans-serif;
        }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .dot {
            stroke: #000;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            width: 100px;
            padding: 5px;
            font: 12px Roboto, Helvetica, Arial;
            background: #5799db;
            border: 0px;
            border-radius: 4px;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script>
        var margin = {
            top: 30,
            right: 30,
            bottom: 30,
            left: 30
        },
            width = 600 - margin.left - margin.right,
            height = 600 - margin.top - margin.bottom;

         // add the graph canvas to the body of the webpage
        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        /* 
         * value accessor - returns the value to encode for a given data object.
         * scale - maps value to a visual display encoding, such as a pixel position.
         * map function - maps from data value to display value
         * axis - sets up axis
         */
    </script>
    <table class='ediTable' contenteditable="true">
        <thead>
            <tr>
                <th>Epic</th>
                <th>Importance</th>
                <th>Urgency</th>
                <th>Size</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Support POD</td>
                <td>10</td>
                <td>9</td>
                <td>3</td>
            </tr>
            <tr>
                <td>PDF A11y</td>
                <td>8</td>
                <td>10</td>
                <td>5</td>
            </tr>
            <tr>
                <td>Ruby/Rails Upgrade</td>
                <td>4</td>
                <td>6</td>
                <td>5</td>
            </tr>
            <tr>
                <td>Improve Docs</td>
                <td>2</td>
                <td>8</td>
                <td>1</td>
            </tr>
            <tr>
                <td>PDF Preflight</td>
                <td>6</td>
                <td>9</td>
                <td>3</td>
            </tr>
            <tr>
                <td>Covers Upgrade</td>
                <td>3</td>
                <td>6</td>
                <td>2</td>
            </tr>
            <tr>
                <td>Support CS Migration</td>
                <td>7</td>
                <td>10</td>
                <td>3</td>
            </tr>
            <tr>
                <td>Better Data Reporting</td>
                <td>1</td>
                <td>2</td>
                <td>2</td>
            </tr>
            <tr>
                <td>"Bugs / Tech Debt, Data Cleanup"</td>
                <td>2</td>
                <td>8</td>
                <td>1</td>
            </tr>
            <tr>
                <td>Support QA in Online</td>
                <td>8</td>
                <td>2</td>
                <td>1</td>
            </tr>
            <tr>
                <td>Absorb Storia Tools</td>
                <td>9</td>
                <td>3</td>
                <td>3</td>
            </tr>
            <tr>
                <td>EPUB Widget Spec</td>
                <td>5</td>
                <td>1</td>
                <td>1</td>
            </tr>
            <tr>
                <td>Better Issue reporting / Content Flagging</td>
                <td>3</td>
                <td>7</td>
                <td>2</td>
            </tr>
            <tr>
                <td>API improvements / relocation</td>
                <td>4</td>
                <td>5</td>
                <td>3</td>
            </tr>
            <tr>
                <td>Compose MVP</td>
                <td>10</td>
                <td>4</td>
                <td>4</td>
            </tr>
            <tr>
                <td>PDF -> FXL EPUB</td>
                <td>9</td>
                <td>5</td>
                <td>4</td>
            </tr>
            <tr>
                <td>Validates MVP</td>
                <td>6</td>
                <td>4</td>
                <td>2</td>
            </tr>
            <tr>
                <td>Responsive and Accessible FLOE Engines</td>
                <td>7</td>
                <td>7</td>
                <td>3</td>
            </tr>
            <tr>
                <td>FLOE 3 MVP</td>
                <td>5</td>
                <td>3</td>
                <td>1</td>
            </tr>
        </tbody>
    </table>
    <script>
        $(document).ready(function() {

            var getData = function() {
                var data = [];
                $('tbody tr').each(function(index, tr) {
                    var cells = $(tr).find('td');
                    var data_object = {
                        'epic': cells[0].innerHTML,
                        'importance': parseInt(cells[1].innerHTML),
                        'urgency': parseInt(cells[2].innerHTML),
                        'size': parseInt(cells[3].innerHTML)
                    };
                    data.push(data_object);
                });
                return data;
            };

            var data = getData();

            // setup x 
            var xValue = function(d) {
                return d.urgency;
            }, // data -> value
                xScale = d3.scale.linear().range([0, width]), // value -> display
                xMap = function(d) {
                    return xScale(xValue(d));
                }, // data -> display
                xAxis = d3.svg.axis().scale(xScale).orient("bottom");

            // setup y
            var yValue = function(d) {
                return d.importance;
            }, // data -> value
                yScale = d3.scale.linear().range([height, 0]), // value -> display
                yMap = function(d) {
                    return yScale(yValue(d));
                }, // data -> display
                yAxis = d3.svg.axis().scale(yScale).orient("left");

            var dotSize = function(d) {
                return d.size;
            };
            // add the tooltip area to the webpage
            var tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // don't want dots overlapping axis, so add in buffer to data domain
            xScale.domain([0, 10]);
            yScale.domain([0, 10]);

            // x-axis
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", -6)
                .style("text-anchor", "end")
                .text("urgency");

            // y-axis
            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("importance");

            var drawDots = function(data) {
                // draw dots
                var svg = d3.select('svg g');
                svg.selectAll(".dot").remove();
                svg.selectAll(".dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("class", "dot")
                    .attr("r", function(d) {
                        return 3 + d.size * d.size;
                    })
                    .attr("cx", xMap)
                    .attr("cy", yMap)
                    .style("fill", function(d) {
                        var colorCat;

                        if (d.urgency < 5 && d.importance < 5) {
                            colorCat = "#ecff5e";
                        } else if (d.urgency >= 5 && d.importance <= 5) {
                            colorCat = "#fa2121";
                        } else if (d.urgency > 5 && d.importance > 5) {
                            colorCat = "#217821";
                        } else {
                            colorCat = "#2121be";
                        }

                        return colorCat;

                    })
                    .style("stroke", function(d) {
                        var colorCat;

                        if (d.urgency < 5 && d.importance < 5) {
                            colorCat = "#ecff5e";
                        } else if (d.urgency >= 5 && d.importance <= 5) {
                            colorCat = "#fa2121";
                        } else if (d.urgency > 5 && d.importance > 5) {
                            colorCat = "#217821";
                        } else {
                            colorCat = "#2121be";
                        }

                        return colorCat;

                    })
                    .on("mouseover", function(d) {
                        tooltip.transition()
                            .duration(400)
                            .style("opacity", 1);
                        tooltip.html(d.epic + "<br/> (" + xValue(d) + ", " + yValue(d) + ", " + dotSize(d) + ")")
                            .style("left", (d3.event.pageX + 5) + "px")
                            .style("top", (d3.event.pageY + 5) + "px");
                    })
                    .on("mouseout", function(d) {
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });
            };
            drawDots(getData());

            $('body').on('focus', '[contenteditable]', function() {
                var $this = $(this);
                $this.data('before', $this.html());
                return $this;
            }).on('blur keyup paste input', '[contenteditable]', function() {
                var $this = $(this);
                if ($this.data('before') !== $this.html()) {
                    $this.data('before', $this.html());
                    $this.trigger('change');
                }
                drawDots(getData());
                return $this;
            });
        });
    </script>
</body>

</html>